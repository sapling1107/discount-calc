<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta property="og:title" content="折扣計算器">
  <meta property="og:description" content="輸入原價、特價或折扣率，任兩個即可自動算出第三個。支援多行與折數提示！">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://sapling1107.github.io/discount-calc/">
  <meta property="og:image" content="https://sapling1107.github.io/discount-calc/og-image.png">
  <title>折扣計算器</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; max-width: 700px; }
    th, td { border: 1px solid #aaa; padding: 8px; text-align: center; }
    input { width: 90px; text-align: right; }
    .note { color: #555; font-size: 0.9em; margin-left: 5px; }
    button { margin-top: 10px; margin-right: 5px; }
  </style>
</head>
<body>
  <h2>折扣計算器（三欄位互算，多行版）</h2>

  <table id="calcTable">
    <thead>
      <tr>
        <th>原價</th>
        <th>特價</th>
        <th>折扣率（85=85折）</th>
        <th>折數提示</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><input type="number" step="0.01" oninput="recalc(this)"></td>
        <td><input type="number" step="0.01" oninput="recalc(this)"></td>
        <td><input type="number" step="0.01" oninput="recalc(this)"></td>
        <td class="note"></td>
      </tr>
    </tbody>
  </table>

  <button onclick="addRow()">新增一行</button>
  <button onclick="clearAll()">清空所有行</button>

  <script>
    function recalc(input) {
      const row = input.parentNode.parentNode;
      const cells = row.getElementsByTagName("input");
      const noteCell = row.getElementsByClassName("note")[0];

      let original = parseFloat(cells[0].value);
      let sale = parseFloat(cells[1].value);
      let discount = parseFloat(cells[2].value);

      // 原價+特價 → 折扣率
      if (!isNaN(original) && !isNaN(sale) && isNaN(discount)) {
        discount = (sale / original) * 100;
        cells[2].value = discount.toFixed(2);
      }
      // 原價+折扣率 → 特價
      else if (!isNaN(original) && isNaN(sale) && !isNaN(discount)) {
        sale = original * (discount / 100);
        cells[1].value = sale.toFixed(2);
      }
      // 特價+折扣率 → 原價
      else if (isNaN(original) && !isNaN(sale) && !isNaN(discount)) {
        original = sale / (discount / 100);
        cells[0].value = original.toFixed(2);
      }

      // 折數提示
      if (!isNaN(discount)) {
        noteCell.textContent = "約 " + (discount / 10).toFixed(1) + " 折";
      } else {
        noteCell.textContent = "";
      }
    }

    function addRow() {
      const tbody = document.getElementById("calcTable").getElementsByTagName("tbody")[0];
      const newRow = document.createElement("tr");

      for (let i = 0; i < 3; i++) {
        const td = document.createElement("td");
        const input = document.createElement("input");
        input.type = "number";
        input.step = "0.01";
        input.oninput = function () { recalc(this); };
        td.appendChild(input);
        newRow.appendChild(td);
      }

      const noteTd = document.createElement("td");
      noteTd.className = "note";
      newRow.appendChild(noteTd);

      tbody.appendChild(newRow);
    }

    function clearAll() {
      const tbody = document.getElementById("calcTable").getElementsByTagName("tbody")[0];
      tbody.innerHTML = ""; // 清空表格內容

      // 加回一行空白輸入
      const row = document.createElement("tr");
      for (let i = 0; i < 3; i++) {
        const td = document.createElement("td");
        const input = document.createElement("input");
        input.type = "number";
        input.step = "0.01";
        input.oninput = function () { recalc(this); };
        td.appendChild(input);
        row.appendChild(td);
      }
      const noteTd = document.createElement("td");
      noteTd.className = "note";
      row.appendChild(noteTd);

      tbody.appendChild(row);
    }
  </script>
</body>
</html>
